# トランザクションについて理解する
## 課題1
### デッドロックとは？  
両方のトランザクションがお互いにロックし合う状態になり、どちらのトランザクションも先に進めず行き詰まってしまいます。
***
**具体例** 
- トランザクション１
  - 口座Xをロック
  - 残高Xを読み取る（1,000,000円) 
  - 振り込む金額を引く(1,000,000円 - 100,000円　= 900,000円)
  - 残高Xを記録(900,000円)
- トランザクション２
  - 口座Yをロック
  - 残高Yを読み取る（1,000,000円)
  - 振り込む金額を引く(1,000,000円 - 100,000円　= 900,000円)
  - 残高Yを記録(900,000円)

トランザクション１が口座Xをロックし、次いで、トランザクション２が口座Yをロックしています、その状態でトランザクション１が口座Yをロックしようとすると、既にトランザクション２によってロックされているため、トランザクション１はブロックされますね。今度はトランザクション２が口座Xのロックを試みますが、こちらもすでにロックされているためトランザクション２はブロックされてしまいます。

結果として、両方のトランザクションがお互いにロックし合う状態にあり、どちらのトランザクションも先に進めず行き詰まってしまいます。
***
### デッドロックの解決方法とは？  
デッドロックを検知できれば、両方ともロールバックするのか、片方だけロールバックをするのであれば、どのような基準でロールバックするほうを決定するのか、でしょうか

### トランザクションの分離レベル(ISOLATION LEVEL)とは？
トランザクションがどれだけ互いに独立しているかを示す概念として、トランザクションの分離レベルがある。

| 分離レベル           | 分離性  | ダーティリード | インコンシステントリード | ロストアップデート | 　ファントムリード　 |
|-----------------|------|:-------:|:------------:|:---------:|:----------:| 
| READ-UNCOMMITED | 低い   |    ◯    |      ◯       |     ◯     |     ◯      |
| READ-COMMITTED  | やや低い |    ×    |      ◯       |     ◯     |     ◯      |
| REPEATABLE-READ | やや高い |    ×    |      ×       |     ◯     |     ◯      |
| SERIALIZABLE    | 高い   |    ×    |      ×       |     ×     |     ×      |

***
**ダーティリードとは？**  
まだコミットしていないデータを読み取ることによっては起きる異常

**インコンシステントリードとは?**  
あるトランザクションの実行結果が、別のトランザクションの実行結果に影響を与えてしまうと、トランザクションが読み取ったデータの整合性が取れていない（Inconsistent)状態になること。　　

**ロストアップデートとは？**  
あるトランザクション１が書いたデータと、同じものを別のトランザクション２が更新する場合、トランザクション２はトランザクション１が書いた結果をみて、実行結果が決まります。　　
もしトランザクション２がトランザクション１が更新する前のデータを元に、同じデータを更新すると、トランザクション１によって行われた更新は、消失(lost)してしまうこと。  

**ファントムリードとは？**  
SQLのように範囲検索があるシステムで主に起きる問題
***

### 行レベルのロック、テーブルレベルのロックの相違  
**行レベルロックについて**   
行レベルでデータをロックします。行レベルでロックすると、複数のユーザーが同一の表の別の行に同時にアクセスできます。その結果、パフォーマンスが大幅に向上します。  

***
**行レベルロックの利点:**
- 異なるセッションが異なる行にアクセスする場合、ロックの競合は少なくなります。  
- ロールバックする変更が少なくなります。  
- 1つの行を長時間ロックできます。   
***

**テーブルロックについて**  
ロックされたテーブルは、トランザクションをコミットするか、全体をロールバックするか、またはテーブルをロックする前のセーブポイントにロールバックするまでロックされる。
***
**テーブルレベルロックの利点:**
- 必要なメモリーが比較的少なくなります。
- 単一のロックだけが必要であるため、テーブルの大部分に対して使用する場合に高速です。
- データの大部分に対して GROUP BY 操作を頻繁に実行する場合や、テーブル全体を頻繁にスキャンする必要がある場合に高速です。
***

**参考文献**  
- [行レベルロックについて](https://docs.oracle.com/cd/E57425_01/121/ZZPRE/GUID-8DC1ED54-9922-416D-9D9C-BF7232973FA4.htm)
- [内部ロックについて](https://dev.mysql.com/doc/refman/5.6/ja/internal-locking.html)  
- [テーブルロックについて](https://docs.oracle.com/cd/E16338_01/server.112/b56299/statements_9015.htm)

### 悲観ロックと楽観ロックの相違


## 課題2
> **Dirty Readとは？**
> 

> **Non-repeatable readとは？**
> 

> **Phantom readとは？**
> 