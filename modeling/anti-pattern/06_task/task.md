# データベース設計のアンチパターンを学ぶ6

## 課題1
```sql
TABLE Student {
id: varchar
name: varchar
status: varchar CHECK(status IN ("studying", "graduated", "suspended"))
} 
```

### 新しい制限の追加
enumの値やcheck制約を追加、削除する構文はないため新たな値の組合せで列を再定義するしかない。  
データベース製品によってはテーブルが空でない場合でなければ列定義を変更できないものもある。  
もし、稼働中のプロジェクト等で使用されているテーブルの場合はテーブルの内容をダンプし、テーブルを再定義したのちにダンプしたデータを再度リストアする必要になることもある。
列定義の変更は頻繁に行うべきではない。  

### 複数のデータベースをサポートする場合、難しい
check制約やenumなどデータベース製品によって列定義を限定する方法が統一されていない。
enumなどMySQL固有の機能である。

複数のデータベースをサポートする場合やデータベースを別の製品にする場合は製品ごとに差異があるため困難となる場合がある。

| DBMS     | ENUM    | CHECK                                 | DOMAIN |
|----------|---------|---------------------------------------|--------|
|  ANSI SQL標準       | なし | SQL89                                 | SQL92  |
|  MySQL   | はい | いいえ | いいえ    |
|  IBM DB2® | いいえ | はい                     | いいえ    |
|  Microsoft SQL Server  | いいえ | はい                       |  いいえ |
| Oracle    | いいえ    | はい                            | いいえ |
| PostgreSQL   | いいえ       | はい                                  | はい |

> **CHECK制約について**  
> CHECK制約はテーブルの値が論理式を満たすかテストする.
> 検索条件がFALSEを返すような行を拒否する。(unknownやtrueの場合は、、行を受け付ける)

## 課題2
./task.puml

> **ON UPDATE CASCADEについて**  
> 親の主キーが変更されると、それを反映して子の値も変更されることを意味します。

## 課題3
- ECサイトを開発していると仮定する
    - 商品の情報を投稿/編集/削除の権限をrole_typeで管理
      - manager/admin/editorを追加したい場合  