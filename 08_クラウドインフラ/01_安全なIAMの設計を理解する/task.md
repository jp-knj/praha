# 安全なIAMの設計を理解する
[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recqdS756KZg7zGT7?blocks=hide)

## 課題１
### 以下の説明をして下さい
- IAMユーザ
  - AWS（Amazon Web Services）のIAM（Identity and Access Management）のサービスを利用して作成されたユーザのことです。IAMユーザはAWSリソースにアクセスするための認証情報を提供し、AWSユーザーやグループにあらかじめ定義された権限を持たせることができます。
- IAMグループ
  - 作成されたグループのことです。IAMグループは、IAMユーザーをまとめて管理するための仕組みであり、階層的な権限を付与したり、パスワードポリシーを定義したりすることができます。
- IAMポリシー
  - 作成されたポリシーのことです。IAMポリシーは、IAMユーザーやグループに割り当てられた権限を定義するための仕組みであり、AWSリソースに対するアクセス権を設定することができます。
- IAMロール
  - 作成されたロールのことです。IAMロールは、AWSリソースに対して安全にアクセスするために使用され、特定のIAMユーザーまたはサービスアカウントに付与された権限を担保することで安全なアクセスを可能にします。
- Permission boundary
  - 作成された権限の上限を定義する仕組みです。Permission boundaryはIAMユーザーやグループに付与された権限を限定し、権限を越えたアクセスを禁止することでセキュリティレベルを高めることができます。
- AWS管理ポリシー
  - アクセス許可管理のアクセスレベルアクセス許可を付与せずに、特定のアクセスレベルを AWS サービスに付与することができます。AWS 管理ポリシーでは、ポリシーを自身で記述する場合よりも簡単に、適切なアクセス許可がユーザー、グループ、ロールに割り当てられます。
- カスタマー管理ポリシー
  - AWS アカウントの複数のプリンシパルエンティティにポリシーをアタッチできます。ポリシーをプリンシパルエンティティにアタッチすると、ポリシーで定義されたアクセス権限がエンティティに付与されます。
[AWS Identity and Access Management](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/access_policies_managed-vs-inline.html#aws-managed-policies)

Q.ホワイトリストパターン、ブラックリストパターンとは
A. ホワイトリストパターンについて
    - 特定のアクションやアクセスを許可するためのアクセス制御手法です。ユーザーが特定のリソースにアクセスするとき、ホワイトリストから受け入れられた値のみが許可されます。例えば、特定のIPアドレスからのアクセスを許可するときなどに使用されます。
A. ブラックリストパターンについて
- 特定のアクションやアクセスを禁止するためのアクセス制御手法です。ユーザーが特定のリソースにアクセスするとき、ブラックリストから拒否された値のみが禁止されます。例えば、特定のIPアドレスからのアクセスを拒否するときなどに使用されます。

## 課題２
Q.なぜ毎回ルートユーザとしてアクセスするのではなく、管理者権限のIAMユーザでログインした方が良いのでしょうか？
A.ルートユーザは最高権限であり、本来は手動で操作するべきではないため、管理者権限のIAMユーザを使用してログインすることがおすすめされます。IAMユーザは、必要な権限を付与して、必要なタスクを実行できるように制限することができるので、安全な環境を保つことができます。また、IAMユーザを使用することで、各ユーザの権限を管理しやすくなります。
[IAMユーザ設計戦略](https://iselegant.hatenablog.com/entry/2020/05/24/215808)

Q.新たな職場に加わり「AWSを扱うためのアカウントをください」とお願いしたところ「このIAMユーザーを社内のエンジニアで共有してるから、ID/passを教えるね」と言われました。このようにひとつのIAMユーザーを使い回すことにはどのような問題があるでしょうか？
A.IAMユーザーを使い回すことは、安全性や管理性を損なう可能性があります。使い回した場合、共有用のIAMユーザーを使用しているため、全てのユーザーが同じ権限を持つことになります。また、一人のユーザーが誤って権限を付与したり、誤って情報を変更した場合も、他のユーザーに影響が出る可能性があります。また AWS CloudTrail でのログ管理がしづらくなるため

Q.「管理者権限を持ったIAMユーザー」を作成した方の中には `AdministratorAccess`ポリシー を付与したユーザーを作成した方もいたのではないでしょうか。
`PowerUserAccess` と非常に似たポリシーのように見えますが、この2つのポリシーは何が違うのでしょうか？
A.IAMロールを操作できるかどうか

Q. `PowerUserAccess` のようにAWSが用意してくれているポリシーを「AWS管理ポリシー」と呼びます。開発者が自ら追加したポリシーは「カスタマー管理ポリシー」と呼ばれます。
これらはどのように使い分けると良いのでしょうか？
A. AWS管理ポリシーは、AWSが提供している組み込みのポリシーを使用して、サービスのセキュリティを確保するのに役立ちます。カスタマー管理ポリシーは、開発者が独自に定義したポリシーを使用して、サービスのセキュリティを強化するのに役立ちます。AWS管理ポリシーを使用すると、基準を維持しながらも、AWSが提供している最新の機能やサービスを利用できます。カスタマー管理ポリシーを使用すると、開発者が独自の要件を満たすために特別なセキュリティを実装できます。また、開発者が独自のポリシーを定義するため、他のユーザーが開発者の個人情報を収集したり、開発者のアプリケーションを悪用したりすることを防ぐことができます。

Q. `AdministratorAccessポリシー` を直接ユーザに付与する方法と、グループに付与してユーザを所属させる方法があります。
どのような理由で、どちらの方が適切だと感じますか？
A. AdministratorAccessポリシーを直接ユーザに付与する場合、権限を持つユーザが増える可能性があります。ユーザが権限を持つ場合、不正なアクセスが行われる可能性があります。グループに付与してユーザを所属させる場合、権限を持つユーザの数を管理しやすくなります。また、権限を持つユーザが増えないため、不正なアクセスに対するリスクを軽減できます。そのため、グループに付与してユーザを所属させる方法が適切だと感じます。

Q.EC2インスタンスにロールを付与するべきか直接ポリシーを付与するべきか、迷われることがあるかもしれません。どのような理由で、どちらの方が適切だと感じますか？
A.EC2インスタンスにロールを付与する方が適切です。ロールを付与する場合、インスタンスは自動的にAWSサービスを使用するためのアクセス許可を受け取ります。ロールを付与することで、インスタンスが必要とするすべての権限を付与することができます。また、インスタンスが変更された場合、その変更に応じて権限を自動的に更新することも可能です。一方、ポリシーを直接付与する場合、インスタンスから受け取ったすべての権限を手動で更新する必要があります。

Q.IAMには「Resource based」と「Identity based」ポリシーがあります。どのような違いがあるのでしょうか？どのような時にどちらを使うべきなのでしょうか？
A. 基本的には許可はIdentity based policy, 拒否はResource based policy という使い分けにするのが良さそうです。また、Resource basedポリシーは、AWSリソース（S3バケットやLambda関数など）に付与するポリシーです。Identity basedポリシーは、IAMユーザーやグループ、ロールなどのIAMエンティティに付与するポリシーです。Resource basedポリシーを使うべきなのは、AWSリソース上での権限を管理したい場合です。Identity basedポリシーを使うべきなのは、IAMユーザーやグループ、ロールなどのIAMエンティティの権限を管理したい場合です。
[ポリシーの評価論理](https://docs.aws.amazon.com/ja_jp/IAM/latest/UserGuide/reference_policies_evaluation-logic.html)

Q.仮にIAMでS3に対する権限を制御したとしても、S3だからこそ気をつけなければいけないポイントがあります。例えばS3をパブリックアクセス可能な設定に変更してしまえば、IAMの設定に関係なく誰でもS3内のオブジェクトを閲覧できます。S3を意図しないアクセスから守るためIAM以外に設定しておいた方が良い項目はないでしょうか？
A.S3をパブリックアクセスから守るためには、IAMのポリシーだけでなく、以下の設定も行う必要があります。
    1. バケットポリシーを使用して、特定のIPアドレスからのアクセスを許可または拒否する。
    2. バケットをプライベートに設定し、外部からのアクセスを拒否する。
    3. オブジェクトレベルのアクセス権限を設定し、特定のユーザーにのみオブジェクトへのアクセスを許可する。
    4. SSL/TLS暗号化を使用して、データを暗号化して保護する。
    5. S3バケットのログを有効にし、不正なアクセスを検出して防止する。
## 課題３
