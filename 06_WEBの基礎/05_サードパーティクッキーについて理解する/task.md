# サードパーティクッキーについて理解する
[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recWNQ1sOkAI9Qivd?blocks=hide)

## 課題１（質問）
- サードパーティクッキーとファーストパーティクッキーの違いを説明してください
  - ファーストパーティクッキー
    - パーソナライズされたコンテンツを提供したり、ウェブサイト上でのユーザーの行動を把握したりするために、ユーザーに関する情報を収集するために使用される。 
    - クッキーはユーザーの好みを記憶するので、シームレスなUXに貢献します。
      - 例えば、ユーザーがWebサイトに戻ってきたときに、好みの言語がすでに選択されていたり、ショッピングカートの商品が残っていたりします。
    - ビジネスの観点からも、Cookieは、異なるオーディエンスセグメントがどのようにサイトをナビゲートし、製品やサービスに関与しているかなど、ユーザーがサイト上でどのように行動しているかに関する情報を提供し、お客様のビジネスがサイトのUX、コピー、画像、または製品情報についてより良い判断を下すことを可能にします 
  
  - サードパーティークッキーは、ウェブ上でユーザーを追跡し、ユーザープロファイルを作成します。そして、アドテクノロジー企業は、ユーザーのプロフィールに基づいて、パーソナライズされた広告をユーザーに表示することができます。 
    - オンラインで靴を探しているときに、同じ靴の広告がインターネット上に表示されたことがあるとしたら、それはサードパーティークッキーのおかげです。 
    - これらのクッキーは通常、ユーザーの年齢、性別、居住地、訪問したウェブサイト、ページ滞在時間、購入に関する情報を収集します。ユーザーは、誰がこのようなデータを収集しているのか、またどのように使用されているのかをほとんど知ることができません。 
 
- サードパーティ Cookie を用いて広告配信ネットワーク（例えばGoogle AdSense など）がどのようにユーザの訪問履歴を把握しているのか、説明してください
  - 通販サイト `shop.example.com` で商品を閲覧 
    - ページに埋め込まれた`iframe`から 広告配信用サーバーに`ad.example.com?page=ultraWideMonitor`をリクエストを送信
    - 広告配信用サーバーでユーザーID発行
    - 発行されたID をクッキーに保存させる `Set-Coookie: ID=demo`
  - SNSサイト`sns.example.co.jp`を閲覧（同じく `ad.example.com` の広告が埋め込まれている）
    - 埋め込まれた`iframe`から `ad.example.com` にリクエストを送信され、`Cookie: ID=demo` が送信される
    - サーバーはクッキーを元に、ユーザーの情報を検索し、ウルトラワイドディスプレイの広告を返す
    - ウルトラワイドディスプレイの広告が `iframe` 上に表示される

- そもそもサードパーティークッキーはどのように生成されるのでしょうか？画像埋め込みやスクリプト埋め込みなど、様々な手法を説明してください
  - img `<img src="https://ads.com/" />` のようにサードパーティへのリクエストに
    対するレスポンス時にレスポンスヘッダーにSet-cookieを利用して付与される
  - iframeタグ
    HTML のインラインフレーム要素 (<iframe>) は、入れ子になった閲覧コンテキストを表現し、現在の HTML ページに他のページを埋め込むことができます。
    -  `<iframe src="https://ads.com/">` のようにサードパーティへのリクエストに対するレスポンス時にレスポンスヘッダーにSet-cookieを利用して付与される 
  - JavaScript 
    例えば初回ログイン時などに、スクリプトからwindow.open("https://ads.com/"); を実行する。

- サードパーティクッキーの扱いはブラウザによってどのような差があるのでしょうか？（特にsafariは他のブラウザと挙動が異なるので、ぜひ調べてみてください！）
  - Chrome 
      Chrome 80 以降、SameSite 値が宣言されていない Cookie は SameSite=Lax として扱われます。外部アクセスは、SameSite=None; Secure 設定のある Cookie のみ可能になります。 
      Chrome でのサードパーティ Cookie のサポートを段階的に廃止する予定です。私たちは、この計画を 2 年以内に行うことを目指しています。 
  - Firefox 
      SameSite=Noneの場合は、Secure属性が必須(つまりHTTPSが必須)。 
      バージョン67.0.1以降、新規ユーザーはサードパーティーcookieのブロックがデフォルト（初期設定）で有効。  
  - Safari 
      デフォルトでサードパーティのCookieをブロック。 
      Intelligent Tracking Prevention(ITP)機能は機械学習を使用してトラッキングデータをローカルに分類し、閲覧履歴がAppleに送信されないようにしています。 
      例えば、example.com がユーザーのクロスサイトを追跡する機能を持つものとして分類されたとする。
      ユーザーが過去30日間にexample.comを操作しなかった場合 
        example.comのWebサイトデータとCookieはすぐに削除され、新しいデータが追加されても引き続き削除されます。
      ユーザーがexample.comを過去24時間に操作する場合
        example.comがサードパーティであるときにそのCookieが利用可能になります。これにより、「YでXアカウントを使用してサインイン」ログインシナリオが可能になります。 ユーザーが過去30日間にexample.comを操作したが、過去24時間は操作しなかった場合
    example.comはCookieを保持しますが、Cookieは分割されます。パーティション化とは、サードパーティがトッププライベートコントロールドメインまたはTLD + 1ごとに一意の分離されたストレージを取得することを意味します。たとえば、account.example.comとwww.example.comはパーティションexample.comを共有します。これにより、クロスサイト追跡のためのCookieの使用を制限しながら、ユーザーがたまにしかサイトにアクセスしない場合でも、ユーザーはログインしたままになります。

## 課題2