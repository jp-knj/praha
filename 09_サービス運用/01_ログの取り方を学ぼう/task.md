# ログの取り方を学ぼう
[課題内容](https://airtable.com/appPxhCPFYGqqN9YU/tblVlFr2q4lIqDKYc/viwX8r6DpCRp80swL/recrPsEbeQF3QYDQe?blocks=hide)

## 課題１
Q.ログレベルとは何でしょうか？
A.特定のログが出力される重要度を表すレベルのことを指します。ログレベルを用いることで、ログを出力するかどうかを決定することができます。
Q.どのようなレベルがあるのでしょうか？
A.ログレベルには、エラー、警告、情報、デバッグなど様々なレベルがあり、それぞれログが出力される重要度を表します。例えば、「エラー」レベルのログは、重要度が最も高く、「情報」レベルのログは、重要度が最も低いということになります。
Q.ログレベルを指定しておくとどのようなメリットがあるのでしょうか？
A.ログレベルを指定しておくと、必要な重要度のログしか出力されないため、ログを処理する際の効率が上がります。また、重要度が高いログが出力されるように設定することで、重大な問題を早期に検知することが可能になり、サービスの運用を安定させることができます。
Q.アプリケーションログにはどのような情報を含めるべきでしょうか？
A.アプリケーションログには、アプリケーションが実行された時間や開始日時、終了日時、エラー発生時間などの時間情報、アプリケーションの処理内容や結果、アプリケーションに関連するユーザーのIDなどのユーザ情報など、アプリケーションに関する様々な情報を含めるべきです。これらの情報を収集することで、アプリケーションの動作を追跡し、不具合を特定し、改善するための参考にすることが可能になります。
Q.逆にログに含めない方が良い情報があれば、教えてください
A.ログに含めない方が良い情報としては、個人情報や機密情報などのプライバシー保護に関する情報を挙げることができます。こうした情報をログに含めると、プライバシー侵害につながる可能性があるため、ログに含めない方が良いと言えます。
Q.どのようなタイミングでログを出力すると良いでしょうか？（例えば「正常系の処理が終了したとき」「例外が生じたとき」など）ログレベルと併せて考えてみましょう
A.ログを出力するタイミングとしては、正常系の処理が開始したとき、正常系の処理が終了したとき、例外が生じたときなどが挙げられます。
また、ログレベルと併せて考えると、
- 正常系の処理が開始したときは「情報」レベルのログを出力
- 正常系の処理が終了したときは「デバッグ」レベルのログを出力
- 例外が生じたときは「エラー」レベルのログを出力すると良いでしょう。
Q.ログを全て人力で検査するのは大変なので、スクリプトなどで集計しやすいように、パースしやすいメッセージを作ることも大切だと言われます。どのようなログメッセージならパースしやすくなるでしょうか？
A.ログメッセージをパースしやすくするためには、ログメッセージに情報を詳細に記載する必要があります。例えば、時間情報を記載するなどして、パースしやすい形式にする必要があります。また、同じ情報を何度も記載しないように、必要な情報だけを記載するようにする必要があります。
ヒント：ログ集計によく使われるDataDogはログをパースするパーサーが標準装備されています。こちらの使い方を読めば、どのようなログがパースしやすくなるか、ヒントが得られるかもしれません

- 以下のログの種類を説明してください 
  - アクセスログ
    - アクセスログとは、サーバーへのリクエスト・レスポンスの情報を記録するログのことです。
  - アプリケーションログ
    - アプリケーションログとは、アプリケーションが実行された時間や開始日時、終了日時、エラー発生時間などの時間情報、アプリケーションの処理内容や結果などを記録するログのことです。
  - エラーログ
    - エラーログとは、アプリケーションで発生したエラーに関する情報を記録するログのことです。
  -（フロントエンドの）ユーザーログ
    - （フロントエンドの）ユーザーログとは、ユーザーがサイトなどのフロントエンドを使用した際の情報を記録するログのことです。
  - データベースのクエリログ
    - データベースのクエリログとは、データベースへのクエリ（SQL文など）を記録するログのことです。
Q.ログローテーションとは何でしょうか？ 
  - どのようなメリット/デメリットがあるのでしょう？
  A. ログローテーションとは、特定のサービスやサーバーなどで記録されたログを定期的に削除し、保存を制限し、管理をしやすくするための仕組みです。メリットとしては、ログの容量を管理できることや、データを検索し易くすることなどが挙げられます。デメリットとしては、古いログを削除するために重要な情報を失う可能性があることなどが挙げられます。
Q.最近では使われる頻度が減りつつありますが、どのような背景があるのでしょうか？
  - 複雑なインフラストラクチャーを構築するためにクラウドストレージなどを使用することが増えています。クラウドストレージでは、多くのログを貯蔵できるため、ログをローテーションする必要性がなくなっています。また、クラウドストレージでは、複数のサーバーでのログの管理を簡単に行えるため、ログローテーションの頻度を低く抑えることが可能です。
Q.最近ではサービスが稼働するインスタンスにログファイルを保存するのは避けた方が良いプラクティスとして言及されることもあります。それは何故でしょうか？
  - A.インスタンス内にログファイルを保存すると、インスタンスが破壊された場合にログファイルが失われてしまいます。また、インスタンス内に多くのログファイルを保存すると、インスタンスの容量を圧迫してしまう可能性があります。そのため、インスタンス内でログを保存するのではなく、クラウドストレージなどの外部ストレージにログを保存することが推奨されています。
    - food for thought 1: 作成されたログファイルの閲覧権限を細かく管理したい時にはどうすれば良いのでしょう？例えばUserに関するログはManager以上の権限を持っていなければ閲覧できないとか。逆に例えばマネージャーが降格してUserに関するログを閲覧不可にする必要が生じた時、誰がどのような手順で管理すれば良いのでしょう？
    - food for thought 2: 特定のログを誰が閲覧したか、または誰が編集したか、どのように確認すれば良いのでしょう？ 
    - food for thought 3: 仮に複数のインスタンス（10個ぐらい）でサービスが運用されていて、リクエストを処理する途中で複数のインスタンスにログが分散したとします。このようなログをどうやって集約すれば良いのでしょう？
    - food for thought 4: システムのストレージ容量をログファイルが食い尽くしてしまうことはないのでしょうか？ 
    - ログを取得する仕組みには大きく分けて「プル型」と「プッシュ型」がありますが、それぞれにどのようなメリットや使い所があるのでしょうか？

## 課題２
関数を実行中に例外が生じた時、関数に渡された引数をログするように実装しました。以下のような具合です
https://gist.github.com/Dowanna/5fb9e0efecde1c3f942133044c910cd8
この実装にはどのようなセキュリティ上の問題がありそうでしょうか？
food for thought 1：仮に秘匿情報が引数に含まれていたら・・・？
food for thought 2：仮にlog4j問題のように、攻撃を目的とした値が引数に含まれていたら・・・？